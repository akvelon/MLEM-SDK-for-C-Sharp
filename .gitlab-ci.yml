image: mcr.microsoft.com/dotnet/sdk:6.0

variables:
  DLL_RELEASE_FOLDER: 'MlemApi\bin\Release\net6.0'

stages:
  - build
  - test

build:
  stage: build
  script: 
    - echo "Compiling the code..."
    - echo git ls-remote https://gitlab.akvelon.net/sdc/mlem-client-dependencies/common-resources.git
    - echo "------------"
    - git ls-remote https://gitlab.akvelon.net/sdc/mlem-client-dependencies/common-resources.git
    - dotnet build -c Release
  artifacts:
    expire_in: 1 week 
    paths:
      - '$env:DLL_RELEASE_FOLDER\MlemApi.dll'

test:
  stage: test
  script:
    - dotnet test -c Release /p:CollectCoverage=true
  coverage: /\|\s*Total\s*\|\s*(\d+[,.]\d+%)/
